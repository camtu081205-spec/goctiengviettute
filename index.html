<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√≥c Ti·∫øng Vi·ªát T·ª≠ T·∫ø | THPT Tr√† B·ªìng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Great+Vibes&display=swap" rel="stylesheet"> 
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> 
    
    <style>
        /* --- C·∫§U H√åNH M√ÄU S·∫ÆC --- */
        :root {
            --primary-color: #43a047; 
            --light-green: #76d275;
            --secondary-color: #f9fbe7; 
            --accent-color: #ffffff; 
            --text-color: #333;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --shadow-color: rgba(0,0,0,0.1);
            --pastel-red: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            --pastel-mint: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
            --confession-bg: linear-gradient(120deg, #fccb90 0%, #d57eeb 100%);
            --game-bg: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            --cor-game-bg: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }

        /* DARK MODE VARIABLES */
        body.dark-mode {
            --primary-color: #66bb6a;
            --light-green: #81c784;
            --secondary-color: #121212;
            --accent-color: #333;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            --shadow-color: rgba(0,0,0,0.5);
            --pastel-red: linear-gradient(135deg, #b71c1c 0%, #880e4f 100%);
            --pastel-mint: linear-gradient(120deg, #1b5e20 0%, #006064 100%);
            --confession-bg: linear-gradient(120deg, #e65100 0%, #4a148c 100%);
            --game-bg: linear-gradient(135deg, #311b92 0%, #0d47a1 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: var(--secondary-color); color: var(--text-color); line-height: 1.6; scroll-behavior: smooth; transition: background-color 0.3s, color 0.3s; }
        a { text-decoration: none; color: inherit; }
        
        /* PRELOADER */
        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: opacity 0.5s ease-out; }
        .loader { border: 8px solid #f3f3f3; border-top: 8px solid var(--primary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loader-text { margin-top: 20px; font-weight: bold; color: var(--primary-color); animation: blink 1.5s infinite; }

        /* SCROLL TO TOP BUTTON */
        #scrollTopBtn { display: none; position: fixed; bottom: 100px; right: 30px; z-index: 99; font-size: 1.2rem; border: none; outline: none; background-color: var(--primary-color); color: white; cursor: pointer; padding: 15px; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: 0.3s; }
        #scrollTopBtn:hover { background-color: var(--light-green); transform: translateY(-3px); }

        /* CHATBOT AI */
        .chat-widget { position: fixed; bottom: 30px; left: 30px; z-index: 1000; }
        .chat-btn { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(45deg, #2196F3, #21CBF3); color: white; display: flex; justify-content: center; align-items: center; font-size: 1.8rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: transform 0.3s; animation: pulse-blue 2s infinite; }
        .chat-btn:hover { transform: scale(1.1); }
        @keyframes pulse-blue { 0% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(33, 150, 243, 0); } 100% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0); } }
        
        .chat-window { display: none; position: absolute; bottom: 80px; left: 0; width: 320px; height: 450px; background: var(--card-bg); border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; flex-direction: column; border: 1px solid #ddd; }
        .chat-header { background: linear-gradient(45deg, #2196F3, #21CBF3); padding: 15px; color: white; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: var(--secondary-color); }
        .chat-footer { padding: 10px; background: var(--card-bg); border-top: 1px solid #eee; display: flex; gap: 5px; }
        .chat-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; outline: none; background: var(--input-bg); color: var(--text-color); }
        .chat-send { background: #2196F3; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
        
        .message { margin-bottom: 10px; max-width: 80%; padding: 10px; border-radius: 15px; font-size: 0.9rem; word-wrap: break-word; }
        .message.bot { background: #e3f2fd; color: #333; border-bottom-left-radius: 2px; align-self: flex-start; }
        .message.user { background: #2196F3; color: white; border-bottom-right-radius: 2px; margin-left: auto; }

        /* HEADER & HERO */
        header { background-color: var(--primary-color); color: #fff; padding: 1rem 0; box-shadow: 0 4px 10px var(--shadow-color); position: sticky; top: 0; z-index: 1000; }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; }
        .logo h1 { font-size: 1.5rem; text-transform: uppercase; font-weight: 700; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        nav ul { display: flex; gap: 20px; list-style: none; }
        nav a:hover { color: var(--accent-color); transition: color 0.3s; }

        /* DARK MODE TOGGLE BTN */
        .theme-switch-wrapper { display: flex; align-items: center; margin-left: 20px; }
        .theme-switch { display: inline-block; height: 34px; position: relative; width: 60px; }
        .theme-switch input { display:none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; }
        .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 26px; left: 4px; position: absolute; transition: .4s; width: 26px; border-radius: 50%; }
        input:checked + .slider { background-color: #2196F3; }
        input:checked + .slider:before { transform: translateX(26px); }
        .theme-icon { margin-left: 10px; color: #fff; font-size: 1.2rem; }

        .hero {
            background: linear-gradient(rgba(67, 160, 71, 0.9), rgba(118, 210, 117, 0.9)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Truong_THPT_Tra_Bong.jpg/1200px-Truong_THPT_Tra_Bong.jpg');
            background-size: cover; background-position: center; color: #fff; text-align: center; padding: 60px 20px;
        }
        .hero h2 { font-family: 'Playfair Display', serif; font-style: italic; font-size: 3.5rem; margin-bottom: 10px; text-shadow: 2px 2px 6px rgba(0,0,0,0.4); }
        .hero .project-info { font-size: 1.3rem; margin-bottom: 30px; font-weight: bold; color: #fffde7; }
        
        /* DASHBOARD */
        .stats-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: -40px; margin-bottom: 50px; position: relative; z-index: 10; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 10px 20px var(--shadow-color); border-bottom: 4px solid var(--primary-color); }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: var(--primary-color); display: block; }
        .stat-label { font-size: 0.9rem; color: var(--text-color); text-transform: uppercase; font-weight: bold; opacity: 0.7; }

        /* CHART */
        .chart-section { background: var(--card-bg); padding: 40px; border-radius: 20px; box-shadow: 0 8px 20px var(--shadow-color); margin-bottom: 50px; text-align: center; }
        .chart-container { position: relative; height: 300px; width: 100%; max-width: 600px; margin: 0 auto; }

        /* ACKNOWLEDGMENT */
        .acknowledgment-box { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 20px; padding: 30px; max-width: 900px; margin: 0 auto 30px; text-align: left; backdrop-filter: blur(5px); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); }
        .acknowledgment-title { color: #ffeb3b; font-size: 1.5rem; text-transform: uppercase; font-weight: bold; text-align: center; margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px; }
        .acknowledgment-content p { margin-bottom: 15px; font-size: 1.1rem; line-height: 1.8; color: #fff; }
        .teacher-name { font-weight: bold; color: #ffeb3b; font-size: 1.2rem; }
        .hero .intro-text { font-size: 1.1rem; max-width: 800px; margin: 0 auto; opacity: 0.95; line-height: 1.8; }

        /* SECTIONS */
        .section-title { text-align: center; margin: 60px 0 30px; color: var(--primary-color); text-transform: uppercase; font-weight: 800; }
        .weekly-update { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .pastel-card { border-radius: 20px; padding: 30px; color: #fff; box-shadow: 0 10px 20px var(--shadow-color); transition: transform 0.3s; position: relative; overflow: hidden; }
        .pastel-card:hover { transform: translateY(-5px); }
        .card-alert { background-image: var(--pastel-red); }
        .card-suggest { background-image: var(--pastel-mint); color: #2e7d32; }
        body.dark-mode .card-suggest { color: #e0f2f1; } 
        .card-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .card-header { font-size: 1.5rem; font-weight: bold; text-transform: uppercase; margin-bottom: 15px; }

        /* VOTING */
        .voting-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .vote-card { background: var(--card-bg); border-radius: 15px; box-shadow: 0 5px 15px var(--shadow-color); padding: 20px; text-align: center; position: relative; border: 2px solid transparent; transition: 0.3s; }
        .vote-card:hover { border-color: var(--primary-color); transform: translateY(-5px); }
        .vs-badge { background: var(--accent-color); color: var(--primary-color); border: 2px solid var(--primary-color); font-weight: bold; width: 45px; height: 45px; line-height: 41px; border-radius: 50%; margin: -10px auto 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .comparison { display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; }
        .word-slang { color: #e53935; font-weight: bold; text-decoration: line-through; opacity: 0.7; font-size: 1.1rem; }
        .word-standard { color: var(--primary-color); font-weight: bold; font-size: 1.3rem; }
        .vote-btn { background: var(--primary-color); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 6px rgba(67, 160, 71, 0.3); }
        .vote-btn:hover { background: var(--light-green); transform: translateY(-2px); }
        .vote-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .vote-count { display: block; margin-top: 10px; font-size: 0.9rem; color: var(--text-color); font-style: italic; transition: color 0.3s; }
        .vote-count.highlight { color: var(--primary-color); font-weight: bold; transform: scale(1.1); }
        
        .btn-tiny-slang:hover { color: #d32f2f !important; }

        /* CONFESSION */
        .confession-container { display: flex; gap: 30px; flex-wrap: wrap; }
        .confession-form { flex: 1; background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 8px 20px var(--shadow-color); min-width: 300px; }
        .confession-display { flex: 1.5; min-width: 300px; height: 400px; overflow-y: auto; padding-right: 10px; }
        .confession-item { background-image: var(--confession-bg); color: #fff; padding: 20px; border-radius: 20px 20px 20px 0; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; }
        .confession-item::after { content: '‚ù§Ô∏è'; position: absolute; bottom: 10px; right: 15px; font-size: 1.2rem; }
        .cfs-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; color: #4a148c; }
        body.dark-mode .cfs-title { color: #fff; }

        /* GAMES */
        .game-section, .cor-game-section { padding: 40px; border-radius: 30px; text-align: center; margin-bottom: 50px; box-shadow: 0 15px 35px var(--shadow-color); position: relative; overflow: hidden; }
        .game-section { background-image: var(--game-bg); }
        .cor-game-section { background-image: var(--cor-game-bg); }
        .game-section::before { content: 'üéÆ'; font-size: 5rem; position: absolute; top: -10px; right: -10px; opacity: 0.2; transform: rotate(15deg); }
        .game-question-box { background: var(--card-bg); padding: 20px; border-radius: 20px; margin: 20px auto; max-width: 600px; box-shadow: 0 5px 15px var(--shadow-color); }
        .game-question-text { font-family: 'Patrick Hand', cursive; font-size: 2.2rem; color: #d32f2f; font-weight: bold; }
        .game-options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 600px; margin: 0 auto; }
        .btn-option { background: rgba(255, 255, 255, 0.8); border: 3px solid #fff; padding: 15px; border-radius: 15px; font-size: 1.2rem; font-weight: bold; color: #444; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
        .btn-option:hover { transform: translateY(-3px); box-shadow: 0 6px 0 rgba(0,0,0,0.1); background: #fff; }
        .btn-option.correct { background: #81c784; color: white; border-color: #4caf50; }
        .btn-option.wrong { background: #e57373; color: white; border-color: #f44336; }
        .game-score { font-family: 'Patrick Hand', cursive; font-size: 1.8rem; color: #fff; font-weight: bold; margin-top: 15px; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
        .btn-start-game { background: #ff7043; color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(255, 112, 67, 0.4); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* MEMORY GAME */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; max-width: 600px; margin: 20px auto; perspective: 1000px; }
        .memory-card { background-color: transparent; height: 100px; perspective: 1000px; cursor: pointer; }
        .memory-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .memory-card.flipped .memory-card-inner { transform: rotateY(180deg); }
        .memory-card.matched .memory-card-inner { opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        .memory-front, .memory-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-weight: bold; }
        .memory-front { background: #fff; color: #333; transform: rotateY(180deg); font-size: 1.1rem; border: 2px solid #fff; }
        .memory-back { background: #5d4037; color: white; font-size: 2rem; }

        /* CERTIFICATE */
        .certificate-section { background: var(--card-bg); padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 50px; border: 4px double var(--primary-color); }
        .cert-btn { background: linear-gradient(45deg, #FFD700, #FF8C00); color: #fff; padding: 15px 30px; border: none; border-radius: 30px; font-weight: bold; font-size: 1.2rem; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 10px rgba(255, 140, 0, 0.4); }

        /* CARD/LIST VIEW */
        .view-controls { text-align: center; margin-bottom: 20px; }
        .btn-view-mode { background: var(--card-bg); border: 2px solid var(--primary-color); color: var(--primary-color); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.3s; margin: 0 5px; }
        .btn-view-mode.active { background: var(--primary-color); color: #fff; }
        .list-view-container { display: none; background: var(--card-bg); padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px var(--shadow-color); max-height: 500px; overflow-y: auto; }
        .list-view-container.show { display: block; }
        .search-container { max-width: 600px; margin: 0 auto 40px; position: relative; display: flex; align-items: center; }
        .search-box { width: 100%; padding: 15px 100px 15px 25px; border-radius: 50px; border: 2px solid var(--primary-color); font-size: 1.1rem; outline: none; box-shadow: 0 4px 10px var(--shadow-color); transition: 0.3s; background: var(--input-bg); color: var(--text-color); }
        .search-box:focus { box-shadow: 0 4px 15px rgba(67, 160, 71, 0.3); border-color: var(--light-green); }
        .search-btn { position: absolute; right: 10px; background: var(--primary-color); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; transition: 0.3s; z-index: 2; }
        .search-btn:hover { background: var(--light-green); }
        .mic-btn { position: absolute; right: 60px; background: #e0e0e0; color: #555; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; transition: 0.3s; z-index: 2; display: flex; align-items: center; justify-content: center; }
        .mic-btn:hover { background: #d5d5d5; }
        .mic-btn.listening { background: #f44336; color: white; animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); } }

        .flip-container-wrapper { display: flex; justify-content: center; gap: 20px; perspective: 1000px; cursor: pointer; margin-bottom: 40px; }
        .flip-card { background-color: transparent; width: 320px; height: 280px; perspective: 1000px; position: relative; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s; transform-style: preserve-3d; box-shadow: 0 6px 12px var(--shadow-color); border-radius: 20px; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 20px; padding: 25px; }
        .flip-card-front { background-color: var(--card-bg); color: var(--primary-color); border: 3px solid var(--primary-color); }
        .flip-card-back { background-color: var(--card-bg); color: var(--primary-color); border: 3px solid var(--light-green); transform: rotateY(180deg); position: relative; overflow: hidden; }
        
        /* C·∫≠p nh·∫≠t l·ªõp ph·ªß ti·∫øng Cor ƒë·ªÉ ch·ªØ d·ªÖ ƒë·ªçc h∆°n */
        .cor-bg-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://vanhoavaphattrien.vn/uploads/images/2021/10/25/11/44/tc-1.jpg'); background-size: cover; background-position: center; opacity: 0.15; z-index: -1; pointer-events: none; backdrop-filter: blur(5px); }
        
        .btn-tts { background: none; border: none; color: var(--primary-color); font-size: 1.2rem; cursor: pointer; margin-left: 10px; transition: transform 0.2s; }
        .btn-tts:hover { transform: scale(1.2); color: #d32f2f; }

        .word-content { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; word-wrap: break-word; }
        .context { font-size: 0.9rem; color: var(--text-color); background: var(--secondary-color); padding: 8px 10px; border-radius: 10px; width: 100%; margin-bottom: 5px; opacity: 0.9; }
        .origin-text { font-size: 0.85rem; color: #e53935; font-style: italic; margin-top: 5px; border-top: 1px dashed #ccc; padding-top: 5px; width: 100%; }
        
        .click-hint { text-align: center; margin-bottom: 25px; font-style: italic; color: var(--text-color); animation: blink 2s infinite; opacity: 0.8; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .study-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 60px; flex-wrap: wrap; }
        .btn-control { padding: 12px 25px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; font-size: 1rem; }
        .btn-skip { background-color: #e0e0e0; color: #555; }
        .btn-next { background-color: var(--primary-color); color: white; box-shadow: 0 4px 8px rgba(67, 160, 71, 0.3); padding: 12px 35px; }
        .btn-next:hover { background-color: var(--light-green); transform: translateY(-2px); }

        .ranking-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 60px; }
        .ranking-box { background: var(--card-bg); padding: 25px; border-radius: 20px; box-shadow: 0 8px 20px var(--shadow-color); display: flex; flex-direction: column; max-height: 550px; }
        .ranking-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid var(--secondary-color); }
        .ranking-header h4 { font-size: 1.3rem; color: var(--primary-color); text-transform: uppercase; font-weight: bold; }
        .table-scroll-container { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .table-scroll-container::-webkit-scrollbar { width: 6px; }
        .table-scroll-container::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 4px; }
        .custom-table { width: 100%; border-collapse: collapse; }
        .custom-table th { text-align: left; padding: 15px; color: var(--text-color); opacity: 0.7; font-size: 0.95rem; font-weight: bold; position: sticky; top: 0; background: var(--card-bg); z-index: 10; border-bottom: 2px solid #eee; }
        .custom-table td { padding: 12px; border-bottom: 1px solid #eee; font-weight: 500; font-size: 0.95rem; color: var(--text-color); }
        .rank-num { display: inline-block; width: 28px; height: 28px; background: #eee; border-radius: 50%; text-align: center; line-height: 28px; font-size: 0.8rem; font-weight: bold; color: #555; }
        .rank-1 { background: #ffc107; color: #fff; border: none; box-shadow: 0 2px 5px rgba(255, 193, 7, 0.4); } 
        .rank-2 { background: #9e9e9e; color: #fff; border: none; } 
        .rank-3 { background: #cd7f32; color: #fff; border: none; } 
        .badge { display: inline-block; padding: 3px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-left: 5px; vertical-align: middle; }
        .badge-ambassador { background: #e0f7fa; color: #006064; border: 1px solid #b2ebf2; }
        .badge-apprentice { background: #f3e5f5; color: #7b1fa2; border: 1px solid #e1bee7; }
        .badge-new { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

        .contribution-section { background: var(--card-bg); padding: 40px; border-radius: 20px; box-shadow: 0 8px 20px var(--shadow-color); max-width: 900px; margin: 0 auto; }
        .form-row { display: flex; gap: 25px; margin-bottom: 20px; }
        .form-group { flex: 1; }
        .form-group label { display: block; margin-bottom: 12px; font-weight: 800; color: var(--primary-color); font-size: 1.3rem; }
        .form-group input, textarea { width: 100%; padding: 20px; border: 2px solid #ccc; border-radius: 15px; font-size: 1.4rem; transition: 0.3s; background: var(--input-bg); color: var(--text-color); }
        .form-group input:focus, textarea:focus { border-color: var(--primary-color); box-shadow: 0 0 10px rgba(67, 160, 71, 0.3); background-color: var(--secondary-color); }
        .submit-btn { width: 100%; padding: 20px; background: var(--primary-color); color: #fff; border: none; border-radius: 15px; font-size: 1.5rem; cursor: pointer; font-weight: bold; transition: 0.3s; box-shadow: 0 6px 15px rgba(67, 160, 71, 0.4); text-transform: uppercase; }

        .btn-export { background: #00897b; color: white; padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; margin-bottom: 10px; float: right; display: flex; align-items: center; gap: 5px; }
        .btn-export:hover { background: #00695c; }

        .share-btn-float { position: fixed; bottom: 30px; right: 30px; background: var(--primary-color); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1001; transition: transform 0.3s; }
        .share-btn-float:hover { transform: scale(1.1); }
        .qr-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; }
        .qr-content { background: white; padding: 30px; border-radius: 20px; text-align: center; }
        .qr-close { margin-top: 20px; background: #e53935; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }

        footer { background: var(--primary-color); color: #fff; text-align: center; padding: 30px; margin-top: 80px; }

        /* --- STYLE CHO GAME C·∫¢NH S√ÅT CH√çNH T·∫¢ (GIAO DI·ªÜN SMARTPHONE) --- */
        .smartphone-ui {
            width: 350px;
            height: 550px;
            background: #fff;
            border-radius: 30px;
            border: 8px solid #333;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        .phone-header {
            background: linear-gradient(90deg, #4267b2, #29487d);
            padding: 15px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            font-size: 1rem;
        }
        .phone-body {
            flex: 1;
            background: #f0f2f5;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .chat-bubble {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 85%;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
            animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .chat-left {
            background: #e4e6eb;
            color: #050505;
            border-bottom-left-radius: 5px;
            align-self: flex-start;
        }
        .chat-right {
            background: #0084ff;
            color: white;
            border-bottom-right-radius: 5px;
            align-self: flex-end;
        }
        
        /* Hi·ªáu ·ª©ng rung l·∫Øc khi ch·ªçn sai */
        .shake-element { animation: shake 0.5s; background: #ffebee; color: red !important; border: 1px solid red; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        .phone-footer {
            padding: 15px;
            background: #fff;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }
        .btn-start-chat {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: #4267b2;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* STYLE CHO T·ª™ TRONG C√ÇU V√Ä ƒê√ÅP √ÅN */
        .spelling-word {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .spelling-word:hover {
            background-color: #e3f2fd;
        }
        
        .spelling-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
            justify-content: center;
            animation: popIn 0.3s ease-out;
        }
        
        .option-btn {
            background: #fff;
            border: 1px solid #ccc;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            color: #333;
            transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .option-btn:hover {
            background: #f0f2f5;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .hero h2 { font-size: 2.5rem; }
            .weekly-update, .flip-container-wrapper, .form-row, .ranking-section, .voting-grid, .confession-container, .stats-dashboard { flex-direction: column; grid-template-columns: 1fr; }
            .flip-card { width: 100%; margin-bottom: 15px; }
            .ranking-box { max-height: 400px; }
            .confession-display { height: 300px; }
            .game-options-grid { grid-template-columns: 1fr; }
            .memory-grid { grid-template-columns: repeat(3, 1fr); }
            .chat-window { width: 90%; left: 5%; bottom: 100px; }
            .smartphone-ui { width: 100%; max-width: 350px; }
        }
    </style>
</head>
<body>

    <div id="preloader">
        <div class="loader"></div>
        <p class="loader-text">ƒêang t·∫£i d·ªØ li·ªáu Ti·∫øng Vi·ªát...</p>
    </div>

    <button id="scrollTopBtn" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>

    <div class="chat-widget">
        <div class="chat-btn" onclick="toggleChat()"><i class="fas fa-comment-dots"></i></div>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <span>Tr·ª£ L√Ω ·∫¢o Ti·∫øng Vi·ªát</span>
                <span style="cursor:pointer" onclick="toggleChat()"><i class="fas fa-times"></i></span>
            </div>
            <div class="chat-body" id="chatBody">
                <div class="message bot">Xin ch√†o! M√¨nh l√† Bot h·ªó tr·ª£ d·ª± √°n "G√≥c Ti·∫øng Vi·ªát T·ª≠ T·∫ø". B·∫°n c·∫ßn gi√∫p g√¨ kh√¥ng?</div>
            </div>
            <div class="chat-footer">
                <input type="text" id="chatInput" class="chat-input" placeholder="Nh·∫≠p c√¢u h·ªèi..." onkeypress="handleChat(event)">
                <button class="chat-send" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <header>
        <div class="container header-content">
            <div class="logo">
                <h1>G√≥c Ti·∫øng Vi·ªát T·ª≠ T·∫ø</h1>
                <span style="font-size: 0.85rem;">THPT Tr√† B·ªìng</span>
            </div>
            <div style="display:flex; align-items:center;">
                <nav>
                    <ul>
                        <li><a href="#">Trang ch·ªß</a></li>
                        <li><a href="#game">Game</a></li>
                        <li><a href="#tracuu">Tra c·ª©u</a></li>
                        <li><a href="#donggop">ƒê√≥ng g√≥p</a></li>
                    </ul>
                </nav>
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="checkbox">
                        <input type="checkbox" id="checkbox" onclick="toggleDarkMode()">
                        <div class="slider round"></div>
                    </label>
                    <i class="fas fa-moon theme-icon"></i>
                </div>
            </div>
        </div>
    </header>

    <section class="hero" data-aos="fade-down">
        <div class="container">
            <h2>"Gi·ªØ G√¨n S·ª± Trong S√°ng C·ªßa Ti·∫øng Vi·ªát"</h2>
            <p class="project-info">D·ª± √°n c·ªßa L√™ V√µ C·∫©m T√∫ & B√πi Th·ªã H·ªìng Th·∫Øm - L·ªõp 12C1</p>
            
            <div class="acknowledgment-box">
                <h3 class="acknowledgment-title"><i class="fas fa-award"></i> L·ªùi Tri √Çn</h3>
                <div class="acknowledgment-content">
                    <p>
                        <i class="fas fa-chalkboard-teacher" style="color:#ffeb3b; margin-right:5px;"></i> 
                        Gi√°o vi√™n h∆∞·ªõng d·∫´n: <span class="teacher-name">C√¥ V√µ Th·ªã S·ª±</span> (M√¥n Ng·ªØ vƒÉn).
                    </p>
                    <p style="font-style: italic;">
                        "Nh√≥m ch√∫ng em xin b√†y t·ªè l√≤ng bi·∫øt ∆°n s√¢u s·∫Øc ƒë·∫øn c√¥ V√µ Th·ªã S·ª± ‚Äì ng∆∞·ªùi ƒë√£ t·∫≠n t√¨nh ch·ªâ d·∫´n..."
                    </p>
                    <hr style="border:0; border-top:1px dashed rgba(255,255,255,0.3); margin: 15px 0;">
                    <p style="font-style: italic;">
                        "ƒê·ªìng th·ªùi, ch√∫ng em xin ch√¢n th√†nh c·∫£m ∆°n <span class="teacher-name">Th·∫ßy Nguy·ªÖn VƒÉn Thanh</span> ƒë√£ nhi·ªát t√¨nh h·ªó tr·ª£ trong vi·ªác d·ªãch thu·∫≠t ti·∫øng Cor."
                    </p>
                </div>
            </div>
            <div class="intro-text">
                <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi kh√¥ng gian t√¥n vinh v·∫ª ƒë·∫πp c·ªßa Ti·∫øng Vi·ªát! N∆°i ƒë√¢y, ch√∫ng m√¨nh c√πng nhau nh·∫≠n di·ªán v√† ƒëi·ªÅu ch·ªânh th√≥i quen s·ª≠ d·ª•ng ng√¥n ng·ªØ.</p>
            </div>
        </div>
    </section>

    <div class="container stats-dashboard" data-aos="fade-up">
        <div class="stat-card">
            <span class="stat-number" id="counter1">0</span>
            <span class="stat-label">L∆∞·ª£t truy c·∫≠p (Real)</span>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="counter2">0</span>
            <span class="stat-label">T·ªïng l∆∞·ª£t b√¨nh ch·ªçn</span>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="counter3">0</span>
            <span class="stat-label">T·ª´ v·ª±ng ƒë√£ thu th·∫≠p</span>
        </div>
    </div>

    <section class="container" data-aos="zoom-in">
        <h3 class="section-title">üìä Ph√¢n T√≠ch D·ªØ Li·ªáu Th·ª±c T·∫ø</h3>
        <div class="chart-section">
            <p style="margin-bottom: 20px;">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán cam k·∫øt s·ª≠ d·ª•ng "Ti·∫øng Vi·ªát chu·∫©n" c·ªßa h·ªçc sinh to√†n tr∆∞·ªùng qua c√°c ƒë·ª£t b√¨nh ch·ªçn.</p>
            <div class="chart-container">
                <canvas id="usageChart"></canvas>
            </div>
            <p style="font-size: 0.9rem; margin-top: 15px; opacity:0.7">*S·ªë li·ªáu ƒë∆∞·ª£c c·∫≠p nh·∫≠t theo th·ªùi gian th·ª±c t·ª´ h·ªá th·ªëng.</p>
        </div>
    </section>

    <section class="container" data-aos="fade-right">
        <h3 class="section-title">Ti√™u ƒêi·ªÉm Tu·∫ßn N√†y</h3>
        <div class="weekly-update">
            <div class="pastel-card card-alert">
                <i class="fas fa-bell card-icon"></i>
                <div class="card-header">T·ª´ L√≥ng C·∫£nh B√°o</div>
                <p style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;">"G·∫•t √¥ d·ªÅ"</p>
                <p>Bi·∫øn √¢m sai l·ªách, l√†m m·∫•t ƒëi v·∫ª ƒë·∫πp thanh ƒëi·ªáu c·ªßa ti·∫øng Vi·ªát. N√™n tr√°nh s·ª≠ d·ª•ng.</p>
            </div>
            <div class="pastel-card card-suggest">
                <i class="fas fa-lightbulb card-icon"></i>
                <div class="card-header">G·ª£i √Ω thay th·∫ø</div>
                <p style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;">"L·ªë lƒÉng / Qu√° ƒë√†"</p>
                <p>H√£y d√πng t·ª´ ng·ªØ ch√≠nh x√°c ƒë·ªÉ di·ªÖn t·∫£ h√†nh ƒë·ªông v∆∞·ª£t qu√° gi·ªõi h·∫°n m·ªôt c√°ch vƒÉn minh.</p>
            </div>
        </div>
    </section>

    <section id="binhchon" class="container" data-aos="fade-left">
        <h3 class="section-title">Th·ª≠ Th√°ch: N√≥i Sao Cho Chu·∫©n?</h3>
        <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem;">C√πng b√¨nh ch·ªçn ƒë·ªÉ cam k·∫øt s·ª≠ d·ª•ng ti·∫øng Vi·ªát vƒÉn minh!</p>
        <div class="voting-grid" id="votingContainer">
            <p style="text-align:center; width:100%; color:#888">ƒêang t·∫£i d·ªØ li·ªáu b√¨nh ch·ªçn t·ª´ Google Sheet...</p>
        </div>
    </section>

    <section class="container" data-aos="zoom-in-up">
        <div class="certificate-section">
            <i class="fas fa-award" style="font-size: 3rem; color: #FFD700; margin-bottom: 15px;"></i>
            <h3 style="color: var(--primary-color);">Tr·ªü Th√†nh ƒê·∫°i S·ª© Ti·∫øng Vi·ªát</h3>
            <p>Nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n ch·ª©ng nh·∫≠n cam k·∫øt t·ª´ d·ª± √°n (File ·∫£nh th·∫≠t).</p>
            <input type="text" id="certName" placeholder="Nh·∫≠p h·ªç v√† t√™n..." style="padding: 10px; width: 60%; margin-top: 10px; border-radius: 10px; border: 1px solid #ccc;">
            <br>
            <button id="btnGetCert" class="cert-btn" onclick="generateCertificate()">
                <i class="fas fa-file-download"></i> T·∫£i Ch·ª©ng Nh·∫≠n V·ªÅ M√°y
            </button>
        </div>
    </section>

    <section id="thutoi" class="container" data-aos="fade-up">
        <h3 class="section-title">üíå G√≥c "Th√∫ T·ªôi Ng·ªçt Ng√†o"</h3>
        <p style="text-align: center; margin-bottom: 30px; opacity:0.7">N∆°i chia s·∫ª nh·ªØng pha "qu√™ ƒë·ªô" v√¨ d√πng sai ti·∫øng Vi·ªát ho·∫∑c hi·ªÉu l·∫ßm ti·∫øng l√≥ng.</p>
        
        <div class="confession-container">
            <div class="confession-form">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">G·ª≠i Confession (·∫®n danh)</h4>
                <div class="form-group">
                    <textarea id="cfsContent" rows="4" placeholder="V√≠ d·ª•: H·ªìi x∆∞a t·ªõ t∆∞·ªüng 'Gato' l√† b√°nh kem, ai ng·ªù l√† ghen ƒÉn t·ª©c ·ªü..."></textarea>
                </div>
                <button class="submit-btn" style="font-size: 1rem; padding: 12px;" onclick="submitConfession()">G·ª≠i B√≠ M·∫≠t</button>
            </div>
            
            <div class="confession-display" id="cfsDisplay">
                <div class="confession-item">
                    <div class="cfs-title">#CFS_102: L·∫ßm t∆∞·ªüng tai h·∫°i</div>
                    <p>H·ªìi m·ªõi v√†o l·ªõp 10, nghe t·ª•i b·∫°n n√≥i "con ƒë√≥ b·ªã 'b√°o'", m√¨nh c·ª© t∆∞·ªüng n√≥ ƒë∆∞·ª£c l√™n b√°o tuy√™n d∆∞∆°ng. Ai ng·ªù "b√°o" l√† b√°o ƒë·ªùi, b√°o h·∫°i. Qu√™ x·ªá lun!</p>
                </div>
                <div class="confession-item">
                    <div class="cfs-title">#CFS_101: Ch·∫±m Zn?</div>
                    <p>M·∫π m√¨nh th·∫•y m√¨nh nh·∫Øn tin "Ch·∫±m Zn", t∆∞·ªüng m√¨nh ƒë√≤i mua k·∫Ωm v·ªÅ th√≠ nghi·ªám h√≥a h·ªçc. Gi·∫£i th√≠ch g√£y l∆∞·ª°i m·∫π m·ªõi hi·ªÉu l√† Tr·∫ßm C·∫£m.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="tracuu" class="container" data-aos="fade-up">
        <h3 class="section-title">Tra C·ª©u & H·ªçc T·∫≠p</h3>
        <div class="search-container">
            <input type="text" id="searchInput" class="search-box" placeholder="Nh·∫≠p t·ª´ l√≥ng b·∫°n mu·ªën t√¨m... (VD: Flex, Check VAR)" onkeyup="searchWord()">
            <button class="mic-btn" onclick="startVoiceSearch()" id="micBtn"><i class="fas fa-microphone"></i></button>
            <button class="search-btn" onclick="searchWord()"><i class="fas fa-search"></i></button>
        </div>
        <p style="text-align: center; font-size: 0.9rem; opacity:0.7" id="resultCount">ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </section>

    <section class="container" data-aos="zoom-in">
        <div class="view-controls">
            <button class="btn-view-mode active" onclick="toggleViewMode('card')"><i class="fas fa-clone"></i> Th·∫ª Flashcard</button>
            <button class="btn-view-mode" onclick="toggleViewMode('list')"><i class="fas fa-list"></i> Xem Danh S√°ch</button>
        </div>

        <p class="click-hint"><i class="fas fa-hand-pointer"></i> B·∫•m v√†o th·∫ª ƒë·ªÉ l·∫≠t!</p>
        
        <div id="cardView" class="flip-container-wrapper">
            <div class="flip-card" onclick="flipOne(this)">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-comments" style="font-size: 2.2rem; margin-bottom: 15px; color: #d32f2f;"></i>
                        <h3>Ti·∫øng L√≥ng (Gen Z)</h3>
                        <p id="displaySlang" class="word-content" style="color:#d32f2f; font-size: 1.6rem; font-weight:bold;">...</p>
                        <button class="btn-tts" onclick="speakWord(event, 'slang')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="flip-card-back">
                        <p>√ù nghƒ©a:</p>
                        <h3 id="displayMeaning" class="word-content">...</h3>
                        <button class="btn-tts" onclick="speakWord(event, 'meaning')"><i class="fas fa-volume-up"></i></button>
                        <div class="origin-text" id="displayOrigin">
                            <i class="fas fa-history"></i> ...
                        </div>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="flipOne(this)">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-book" style="font-size: 2.2rem; margin-bottom: 15px; color: var(--primary-color);"></i>
                        <h3>Ti·∫øng Vi·ªát Chu·∫©n</h3>
                        <p class="hint">(L·∫≠t ƒë·ªÉ xem)</p>
                    </div>
                    <div class="flip-card-back">
                        <p>T·ª´ chu·∫©n:</p>
                        <h3 id="displayStandard" class="word-content">...</h3>
                        <div class="context">
                            <strong id="displayContext">...</strong>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flip-card" onclick="flipOne(this)">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <i class="fas fa-mountain" style="font-size: 2.2rem; margin-bottom: 15px; color: #f57f17;"></i>
                        <h3>Ti·∫øng Cor</h3>
                        <p class="hint">(Ng√¥n ng·ªØ ƒë·ªãa ph∆∞∆°ng)</p>
                    </div>
                    <div class="flip-card-back">
                        <div class="cor-bg-overlay"></div>
                        <p>Trong ti·∫øng Cor n√≥i l√†:</p>
                        <h3 class="word-content" id="displayCor">...</h3> 
                        <span style="font-size: 0.9rem;">(C·∫ßn b·ªï sung b·ªüi c√°c b·∫°n h·ªçc sinh ng∆∞·ªùi Cor)</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="listView" class="list-view-container">
            <button class="btn-export" onclick="exportData()"><i class="fas fa-file-excel"></i> Xu·∫•t Excel</button>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>T·ª´ L√≥ng</th>
                        <th>Ti·∫øng Vi·ªát Chu·∫©n</th>
                        <th>Ngu·ªìn G·ªëc / Ghi ch√∫</th>
                        <th>Ti·∫øng Cor</th> 
                        <th>Nghe</th>
                    </tr>
                </thead>
                <tbody id="fullDictionaryTable"></tbody>
            </table>
        </div>

        <div class="study-controls">
            <button class="btn-control btn-skip" onclick="nextWord()">
                <i class="fas fa-forward"></i> B·ªè qua
            </button>
            <button class="btn-control btn-next" onclick="nextWord()">
                Ti·∫øp theo <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </section>

    <section id="game" class="container" data-aos="fade-up">
        <h3 class="section-title">üéÆ Mini-Game: ƒê·ªë Vui Si√™u T·ªëc</h3>
        <div class="game-section">
            <div id="gameStartScreen">
                <p style="font-size: 1.2rem; margin-bottom: 20px;">H√£y ch·ªçn ƒë√°p √°n ƒë√∫ng cho c√°c t·ª´ l√≥ng sau ƒë√¢y!</p>
                <button class="btn-start-game" onclick="startGame()">B·∫Øt ƒë·∫ßu ch∆°i</button>
            </div>
            
            <div id="gamePlayArea" style="display: none;">
                <p>T·ª´ l√≥ng n√†y nghƒ©a l√† g√¨?</p>
                <div class="game-question-box">
                    <div class="game-question-text" id="gameQuestionText">...</div>
                </div>
                
                <div class="game-options-grid" id="gameOptions">
                </div>
                <div class="game-score" id="gameScore">ƒêi·ªÉm: 0</div>
            </div>
        </div>
    </section>

    <section id="gameCor" class="container" data-aos="fade-up">
        <h3 class="section-title">ü§ù Mini-Game: K·∫øt N·ªëi B·∫£n S·∫Øc (Ti·∫øng Cor)</h3>
        <div class="cor-game-section">
            <p style="color: #fff; font-size: 1.1rem; margin-bottom: 20px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
                L·∫≠t h√¨nh ƒë·ªÉ t√¨m c·∫∑p t·ª´: <b>Ti·∫øng Vi·ªát</b> v√† <b>Ti·∫øng Cor</b> t∆∞∆°ng ·ª©ng!
            </p>
            <div class="memory-grid" id="corMemoryGrid">
            </div>
            <button class="btn-start-game" style="margin-top:20px; background:#fff; color:#e65100" onclick="resetCorGame()">Ch∆°i l·∫°i</button>
        </div>
    </section>
    
    <section id="canhsatchinhta" class="container" data-aos="zoom-in" style="margin-top: 60px;">
        <h3 class="section-title">üö® Bi·ªát ƒê·ªôi "C·∫£nh S√°t Ch√≠nh T·∫£"</h3>
        <p style="text-align: center; margin-bottom: 30px; opacity:0.8">ƒê·ªçc tin nh·∫Øn, b·∫•m v√†o t·ª´ sai v√† ch·ªçn ƒë√°p √°n ƒë√∫ng ƒë·ªÉ s·ª≠a l·ªói!</p>
        
        <div class="smartphone-ui">
            <div class="phone-header">
                <span><i class="fas fa-chevron-left"></i> Crush ü•∞</span>
                <span><i class="fas fa-phone-alt"></i> <i class="fas fa-video"></i></span>
            </div>
            
            <div class="phone-body" id="spellingGameBody">
                <div class="chat-bubble chat-left">
                    H·∫ø l√¥, h√¥m nay r·∫£nh kh√¥ng?
                </div>
                <button class="btn-start-game btn-start-chat" onclick="startSpellingGame()">B·∫ÆT ƒê·∫¶U CH√ÅT</button>
            </div>
            
            <div class="phone-footer">
                <span><i class="fas fa-star" style="color: gold;"></i> ƒêi·ªÉm: <b id="spellingScore">0</b></span>
                <span><i class="fas fa-stopwatch" style="color: #d32f2f;"></i> <b id="spellingTimer">30s</b></span>
            </div>
        </div>
    </section>

    <section id="xephang" class="container" data-aos="zoom-in">
        <h3 class="section-title">B·∫£ng V√†ng Ghi Danh (Online)</h3>
        <div class="ranking-section">
            <div class="ranking-box">
                <div class="ranking-header">
                    <i class="fas fa-fire" style="color: #e53935; font-size: 1.6rem;"></i>
                    <h4>Top T·ª´ L√≥ng ƒêang Hot</h4>
                </div>
                <div class="table-scroll-container">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">H·∫°ng</th>
                                <th>T·ª´ l√≥ng</th>
                                <th style="text-align: right;">L∆∞·ª£t tra c·ª©u</th>
                            </tr>
                        </thead>
                        <tbody id="hotSlangTable">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="ranking-box">
                <div class="ranking-header">
                    <i class="fas fa-crown" style="color: var(--primary-color); font-size: 1.6rem;"></i>
                    <h4>Top 50 S·ª© Gi·∫£ Ti·∫øng Vi·ªát</h4>
                </div>
                <div class="table-scroll-container">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>H·ªç v√† T√™n</th>
                                <th style="text-align: right;">ƒê√≥ng g√≥p</th>
                            </tr>
                        </thead>
                        <tbody id="top50Table">
                             <tr><td colspan="3" style="text-align:center">ƒêang t·∫£i b·∫£ng x·∫øp h·∫°ng...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <section id="donggop" class="container" data-aos="fade-up">
        <h3 class="section-title">ƒê√≥ng G√≥p T·ª´ ƒêi·ªÉn M·ªõi</h3>
        <div class="contribution-section">
            <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem; opacity: 0.8">D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ª±c ti·∫øp l√™n Google Sheets c·ªßa D·ª± √Ån.</p>
            
            <form id="formDongGop" onsubmit="xuLyGuiForm(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>H·ªç t√™n:</label>
                        <input type="text" id="inpHoTen" placeholder="T√™n c·ªßa b·∫°n" required>
                    </div>
                    <div class="form-group">
                        <label>L·ªõp:</label>
                        <input type="text" id="inpLop" placeholder="L·ªõp" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>T·ª´ L√≥ng (C·∫ßn s·ª≠a):</label>
                        <input type="text" id="inpTuLong" placeholder="V√≠ d·ª•: Lem·ªèn" required>
                    </div>
                    <div class="form-group">
                        <label>Ti·∫øng Vi·ªát chu·∫©n:</label>
                        <input type="text" id="inpTiengViet" placeholder="V√≠ d·ª•: Ch·∫£nh" required>
                    </div>
                    <div class="form-group">
                        <label>Ti·∫øng Cor (N·∫øu bi·∫øt):</label>
                        <input type="text" id="inpTiengCor" placeholder="Nh·∫≠p t·ª´ ti·∫øng Cor...">
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 30px;">
                    <label>Gi·∫£i th√≠ch th√™m (S·ª± t√≠ch/Ngu·ªìn g·ªëc):</label>
                    <textarea id="inpGiaiThich" rows="3" placeholder="Ng·ªØ c·∫£nh ho·∫∑c v√¨ sao c√≥ t·ª´ n√†y..."></textarea>
                </div>
                <button type="submit" class="submit-btn"><i class="fas fa-paper-plane"></i> G·ª≠i ƒê√≥ng G√≥p</button>
            </form>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 D·ª± √°n G√≥c Ti·∫øng Vi·ªát T·ª≠ T·∫ø - Tr∆∞·ªùng THPT Tr√† B·ªìng</p>
    </footer>

    <div class="share-btn-float" onclick="openQR()"><i class="fas fa-qrcode"></i></div>
    
    <div id="qrModal" class="qr-modal">
        <div class="qr-content">
            <h3 style="color:var(--primary-color); margin-bottom:15px;">Qu√©t M√£ ƒê·ªÉ Chia S·∫ª</h3>
            <div id="qrcode"></div>
            <button class="qr-close" onclick="closeQR()">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH LI√äN K·∫æT (C·∫¨P NH·∫¨T M·ªöI NH·∫§T) ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbznWVCFTjtdeHpgqE9aMyzn2qhRtMtpe0N8WXFlVclRJF2j6ii75DJ_s_7M9mKw8IRMvA/exec"; 
        
        // D·ªØ li·ªáu m·∫∑c ƒë·ªãnh (d√πng khi ch∆∞a t·∫£i ƒë∆∞·ª£c ho·∫∑c m·∫•t m·∫°ng)
        const defaultDictionaryData = [
            { slang: "Flex", standard: "Khoe khoang", context: "Khoe th√†nh t√≠ch", origin: "Ti·∫øng Anh: Flex muscle", cor: "[Ch∆∞a r√µ]", contributor: "Admin", classInfo: "BTC" },
            { slang: "Check VAR", standard: "Ki·ªÉm ch·ª©ng", context: "Ki·ªÉm tra l·∫°i th√¥ng tin", origin: "C√¥ng ngh·ªá VAR b√≥ng ƒë√°", cor: "[Ch∆∞a r√µ]", contributor: "Admin", classInfo: "BTC" },
            { slang: "Over h·ª£p", standard: "R·∫•t h·ª£p", context: "C·ª±c k·ª≥ ph√π h·ª£p", origin: "Over (qu√°) + H·ª£p", cor: "[Ch∆∞a r√µ]", contributor: "Admin", classInfo: "BTC" },
            { slang: "Kiwi kiwi", standard: "Ngon", context: "Khen m√≥n ƒÉn", origin: "C√°ch n√≥i l√°i t·ª´ 'Kiwii'", cor: "[Ch∆∞a r√µ]", contributor: "Admin", classInfo: "BTC" },
            { slang: "X·ªãt keo", standard: "C·ª©ng h·ªçng", context: "B·∫•t ng·ªù kh√¥ng n√≥i n√™n l·ªùi", origin: "Ng√¥n ng·ªØ m·∫°ng", cor: "[Ch∆∞a r√µ]", contributor: "Admin", classInfo: "BTC" }
        ];

        let dictionary = []; 
        let globalPolls = []; 
        let currentCardIndex = 0; // Bi·∫øn theo d√µi th·∫ª hi·ªán t·∫°i
        const bannedWords = ["dm", "ƒëm", "vcl", "vl", "cc", "ƒë·ª•", "l·ªìn", "bu·ªìi", "ngu", "ch√≥", "sex"];
        let usageChartInstance = null;

        // --- 1. H√ÄM T·∫¢I D·ªÆ LI·ªÜU T·ª™ GOOGLE SHEET ---
        async function loadDataFromSheet() {
            const preloader = document.getElementById('preloader');
            try {
                // G·ª≠i request ƒë·∫øm view (No-CORS ƒë·ªÉ tr√°nh l·ªói ch·∫∑n)
                fetch(SCRIPT_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    body: new URLSearchParams({ action: 'view' }) 
                }).catch(e => console.log("L·ªói ƒë·∫øm view:", e));

                // T·∫£i d·ªØ li·ªáu ch√≠nh
                let response = await fetch(SCRIPT_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                let data = await response.json();

                // A. C·∫¨P NH·∫¨T T·ª™ ƒêI·ªÇN
                if (data.dictionary && Array.isArray(data.dictionary)) {
                    // MAP D·ªÆ LI·ªÜU T·ª™ SHEET (C·ªòT VI·ªÜT) SANG BI·∫æN JS
                    dictionary = data.dictionary.map(item => ({
                        slang: item.TuLong || item.slang || "", 
                        standard: item.TiengViet || item.standard || "",
                        context: item.GiaiThich || item.context || "",
                        origin: "ƒê√≥ng g√≥p b·ªüi " + (item.HoTen || item.hoten || "·∫®n danh"),
                        cor: item.TiengCo || item.cor || "[Ch∆∞a r√µ]",
                        // QUAN TR·ªåNG: L·∫•y ƒë√∫ng c·ªôt HoTen ƒë·ªÉ x·∫øp h·∫°ng
                        contributor: item.HoTen || item.hoten || item.Hoten || "·∫®n danh",
                        classInfo: item.Lop || ""
                    }));

                    if(dictionary.length === 0) dictionary = defaultDictionaryData;
                    document.getElementById('resultCount').innerText = `ƒêang hi·ªÉn th·ªã ${dictionary.length} t·ª´ trong kho d·ªØ li·ªáu (Online)`;
                } else {
                    dictionary = defaultDictionaryData;
                }

                // B. C·∫¨P NH·∫¨T S·ªê LI·ªÜU TH·ªêNG K√ä
                if (data.stats) {
                     // N·∫øu API tr·∫£ v·ªÅ d·∫°ng m·∫£ng
                     if(Array.isArray(data.stats)) {
                         let viewStat = data.stats.find(s => s.Name === 'PageViews');
                         if(viewStat) animateValue("counter1", 0, viewStat.Value, 2000);
                     } 
                     // N·∫øu API tr·∫£ v·ªÅ object
                     else if (data.stats.views) {
                        animateValue("counter1", 0, data.stats.views, 2000);
                     }
                }

                // C. C·∫¨P NH·∫¨T B√åNH CH·ªåN
                if (data.polls && Array.isArray(data.polls)) {
                    // Map polls data
                    globalPolls = data.polls.map(p => ({
                        id: p.ID,
                        slang: p.TuLong,
                        standard: p.TiengViet,
                        voteA: p.VoteA || 0,
                        voteB: p.VoteB || 0,
                        active: p.Active
                    })).filter(p => p.active === true);

                    renderVotingSection(globalPolls);
                    updateChartReal(globalPolls);
                    
                    let totalVotes = globalPolls.reduce((acc, curr) => acc + curr.voteA + curr.voteB, 0);
                    animateValue("counter2", 0, totalVotes, 2000);
                }
                
                // D. C·∫¨P NH·∫¨T TOP 50 - S·ª¨A L·ªñI ·ªû ƒê√ÇY
                // Lu√¥n lu√¥n t·ª± t√≠nh to√°n t·ª´ dictionary ƒë·ªÉ ƒë·∫£m b·∫£o ch√≠nh x√°c
                renderTop50(); 

                renderApp(); // Hi·ªÉn th·ªã giao di·ªán ch√≠nh

            } catch (error) {
                console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error);
                document.getElementById('resultCount').innerText = "‚ö†Ô∏è ƒêang d√πng d·ªØ li·ªáu m·∫´u (L·ªói k·∫øt n·ªëi)";
                dictionary = defaultDictionaryData;
                renderApp();
            } finally {
                if(preloader) {
                    preloader.style.opacity = '0';
                    setTimeout(() => { preloader.style.display = 'none'; }, 500);
                }
            }
        }

        // --- C√ÅC H√ÄM HI·ªÇN TH·ªä D·ªÆ LI·ªÜU ---
        function renderApp() {
            if (dictionary.length > 0) {
                renderCard(0);
                renderListView(); 
                renderHotSlangTable();
            }
            animateValue("counter3", 0, dictionary.length, 1000);
        }

        // Hi·ªÉn th·ªã Flashcard
        function renderCard(index) {
            if (dictionary.length === 0) return;
            const item = dictionary[index];
            
            // Reset tr·∫°ng th√°i l·∫≠t th·∫ª
            document.querySelectorAll('.flip-card').forEach(card => card.classList.remove('flipped'));

            // G√°n d·ªØ li·ªáu
            document.getElementById('displaySlang').innerText = `"${item.slang}"`;
            document.getElementById('displayMeaning').innerText = item.standard;
            document.getElementById('displayOrigin').innerHTML = `<i class="fas fa-history"></i> ${item.origin || 'Ch∆∞a r√µ ngu·ªìn g·ªëc'}`;
            
            document.getElementById('displayStandard').innerText = item.standard;
            document.getElementById('displayContext').innerText = item.context || "Ch∆∞a c√≥ ng·ªØ c·∫£nh c·ª• th·ªÉ";
            
            // X·ª≠ l√Ω Ti·∫øng Cor
            const corText = item.cor && item.cor !== "" ? item.cor : "[ƒêang c·∫≠p nh·∫≠t]";
            document.getElementById('displayCor').innerText = corText;
        }

        // Chuy·ªÉn t·ª´ ti·∫øp theo
        function nextWord() {
            if (dictionary.length === 0) return;
            currentCardIndex++;
            if (currentCardIndex >= dictionary.length) {
                currentCardIndex = 0; // Quay l·∫°i ƒë·∫ßu
            }
            renderCard(currentCardIndex);
        }

        // Hi·ªÉn th·ªã danh s√°ch List View
        function renderListView() {
            const tableBody = document.getElementById('fullDictionaryTable');
            let html = "";
            dictionary.forEach(item => {
                html += `
                    <tr>
                        <td style="font-weight:bold; color:#e53935">${item.slang}</td>
                        <td style="color:var(--primary-color)">${item.standard}</td>
                        <td style="font-size:0.9rem">${item.context || ''} <br> <i style="color:#888">${item.origin || ''}</i></td>
                        <td style="font-weight:bold; color:#f57f17">${item.cor || ''}</td>
                        <td><button class="btn-tts" onclick="speakWord(event, '${item.standard}')"><i class="fas fa-volume-up"></i></button></td>
                    </tr>
                `;
            });
            tableBody.innerHTML = html;
        }

        // Hi·ªÉn th·ªã Top 50 (ƒê√É S·ª¨A: T·ª± ƒë·ªông t√≠nh to√°n t·ª´ dictionary)
        function renderTop50(realData = null) {
            const tbody = document.getElementById('top50Table');
            let html = "";
            let dataToRender = [];

            // T·ª± ƒë·ªông gom nh√≥m t√™n ng∆∞·ªùi ƒë√≥ng g√≥p
            let counts = {};
            dictionary.forEach(item => {
                // Chu·∫©n h√≥a t√™n: b·ªè kho·∫£ng tr·∫Øng th·ª´a
                let name = item.contributor ? item.contributor.trim() : "";
                
                // Ch·ªâ ƒë·∫øm n·∫øu c√≥ t√™n v√† kh√¥ng ph·∫£i l√† Admin/·∫®n danh
                if (name && name.toLowerCase() !== 'admin' && name.toLowerCase() !== '·∫©n danh') {
                    counts[name] = (counts[name] || 0) + 1;
                }
            });

            // Chuy·ªÉn object counts th√†nh m·∫£ng ƒë·ªÉ s·∫Øp x·∫øp
            dataToRender = Object.keys(counts).map(key => ({
                name: key,
                count: counts[key]
            }));

            // S·∫Øp x·∫øp gi·∫£m d·∫ßn theo s·ªë l∆∞·ª£ng ƒë√≥ng g√≥p
            dataToRender.sort((a, b) => b.count - a.count);

            if(dataToRender.length === 0) {
                 html = `<tr><td colspan="3" style="text-align:center; padding:20px;">Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√≥ng g√≥p. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</td></tr>`;
            } else {
                dataToRender.slice(0, 50).forEach((user, index) => {
                    let rank = index + 1;
                    let badge = "";
                    if (rank <= 3) badge = `<span class="badge badge-ambassador">ƒê·∫°i s·ª©</span>`;
                    else if (rank <= 10) badge = `<span class="badge badge-apprentice">T√≠ch c·ª±c</span>`;
                    
                    html += `
                        <tr>
                            <td><span class="rank-num ${rank <= 3 ? 'rank-'+rank : 'rank-num'}">${rank}</span></td>
                            <td>${user.name} ${badge}</td>
                            <td style="text-align: right;">${user.count} t·ª´</td>
                        </tr>
                    `;
                });
            }
            tbody.innerHTML = html;
        }

        // T√¨m ki·∫øm
        function searchWord() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = dictionary.filter(item => 
                item.slang.toLowerCase().includes(query) || 
                item.standard.toLowerCase().includes(query)
            );
            
            // C·∫≠p nh·∫≠t List View
            const tableBody = document.getElementById('fullDictionaryTable');
            if(filtered.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" style="text-align:center">Kh√¥ng t√¨m th·∫•y t·ª´ n√†o. <a href="#donggop" style="color:blue">ƒê√≥ng g√≥p ngay?</a></td></tr>`;
            } else {
                let html = "";
                filtered.forEach(item => {
                    html += `<tr>
                        <td style="font-weight:bold; color:#e53935">${item.slang}</td>
                        <td style="color:var(--primary-color)">${item.standard}</td>
                        <td>${item.context || ''}</td>
                        <td>${item.cor || ''}</td>
                        <td><button class="btn-tts" onclick="speakWord(event, '${item.standard}')"><i class="fas fa-volume-up"></i></button></td>
                    </tr>`;
                });
                tableBody.innerHTML = html;
            }

            // N·∫øu ƒëang ·ªü Card View, t√¨m th·∫ª ƒë·∫ßu ti√™n kh·ªõp
            if (filtered.length > 0) {
                // T√¨m index c·ªßa ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n trong m·∫£ng g·ªëc
                const firstMatch = dictionary.findIndex(d => d.slang === filtered[0].slang);
                if (firstMatch !== -1) {
                    currentCardIndex = firstMatch;
                    renderCard(currentCardIndex);
                }
            }
        }

        // --- C√ÅC H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN (UI) ---
        
        function flipOne(card) {
            card.classList.toggle('flipped');
        }

        function toggleViewMode(mode) {
            const btns = document.querySelectorAll('.btn-view-mode');
            btns.forEach(b => b.classList.remove('active'));
            
            if (mode === 'card') {
                document.getElementById('cardView').style.display = 'flex';
                document.getElementById('listView').classList.remove('show');
                document.querySelector('.study-controls').style.display = 'flex';
                document.querySelector('.click-hint').style.display = 'block';
                btns[0].classList.add('active');
            } else {
                document.getElementById('cardView').style.display = 'none';
                document.getElementById('listView').classList.add('show');
                document.querySelector('.study-controls').style.display = 'none';
                document.querySelector('.click-hint').style.display = 'none';
                btns[1].classList.add('active');
            }
        }

        function renderVotingSection(polls) {
            const container = document.getElementById('votingContainer');
            if(polls.length === 0) {
                container.innerHTML = "<p>Hi·ªán ch∆∞a c√≥ cu·ªôc b√¨nh ch·ªçn n√†o ƒëang di·ªÖn ra.</p>";
                return;
            }

            let html = "";
            polls.forEach((poll) => {
                const isVoted = localStorage.getItem('voted_' + poll.id);
                const btnState = isVoted ? 'disabled' : '';
                const btnText = isVoted ? '<i class="fas fa-check"></i> ƒê√£ Ghi Nh·∫≠n' : '<i class="fas fa-heart"></i> Ch·ªçn Ti·∫øng Vi·ªát';

                html += `
                <div class="vote-card">
                    <div class="vs-badge">VS</div>
                    <div class="comparison">
                        <span class="word-slang" style="display:block; margin-bottom:5px">"${poll.slang}"</span>
                        <span style="font-size:0.8rem; color:#888">(${poll.voteA} phi·∫øu)</span>
                        <br>
                        <i class="fas fa-arrow-down" style="color:#ccc; margin: 10px 0;"></i>
                        <br>
                        <span class="word-standard" style="display:block; margin-bottom:5px">"${poll.standard}"</span>
                        <span style="font-size:0.8rem; color:var(--primary-color); font-weight:bold">(${poll.voteB} phi·∫øu)</span>
                    </div>
                    <button id="btn_${poll.id}" class="vote-btn" ${btnState} onclick="handleRealVote(this, '${poll.id}', ${poll.id}, 'B')">
                        ${btnText}
                    </button>
                    <div style="margin-top:10px; font-size:0.8rem; color:#666">
                        B·∫°n th√≠ch d√πng t·ª´ n√†o h∆°n? <br>
                        <button class="btn-tiny-slang" ${btnState} onclick="handleRealVote(this, '${poll.id}', ${poll.id}, 'A')" style="border:none; background:none; color:#e53935; cursor:pointer; text-decoration:underline;">Th√≠ch d√πng t·ª´ l√≥ng h∆°n</button>
                    </div>
                </div>
                `;
            });
            container.innerHTML = html;
        }

        function handleRealVote(btn, pollId, rowIndex, type) {
            if(localStorage.getItem('voted_' + pollId)) return;

            const card = btn.closest('.vote-card');
            const mainBtn = card.querySelector('.vote-btn');
            mainBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang g·ª≠i...';
            mainBtn.disabled = true;

            const params = new URLSearchParams();
            params.append('action', 'vote');
            params.append('id', pollId); // S·ª≠a rowIndex th√†nh id
            params.append('type', type);

            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: params })
            .then(() => {
                localStorage.setItem('voted_' + pollId, 'true');
                mainBtn.innerHTML = '<i class="fas fa-check"></i> ƒê√£ Ghi Nh·∫≠n';
                alert("C·∫£m ∆°n b·∫°n ƒë√£ b√¨nh ch·ªçn! K·∫øt qu·∫£ s·∫Ω c·∫≠p nh·∫≠t sau khi t·∫£i l·∫°i trang.");
            })
            .catch(err => {
                alert("L·ªói m·∫°ng! Vui l√≤ng th·ª≠ l·∫°i.");
                mainBtn.disabled = false;
                mainBtn.innerHTML = '<i class="fas fa-heart"></i> Ch·ªçn Ti·∫øng Vi·ªát';
            });
        }

        function updateChartReal(polls) {
            const ctx = document.getElementById('usageChart').getContext('2d');
            let labels = [];
            let dataValues = [];
            
            polls.forEach(p => {
                labels.push(p.standard);
                dataValues.push(p.voteB); 
            });

            if(usageChartInstance) usageChartInstance.destroy();

            usageChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£t cam k·∫øt',
                        data: dataValues,
                        backgroundColor: ['#43a047', '#ffeb3b', '#2196f3', '#ff9800', '#9c27b0'],
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
        
        function animateValue(id, start, end, duration) {
            let obj = document.getElementById(id);
            if(!obj) return;
            let range = end - start;
            let minTimer = 50;
            let stepTime = Math.abs(Math.floor(duration / range));
            stepTime = Math.max(stepTime, minTimer);
            let startTime = new Date().getTime();
            let endTime = startTime + duration;
            let timer;
            function run() {
                let now = new Date().getTime();
                let remaining = Math.max((endTime - now) / duration, 0);
                let value = Math.round(end - (remaining * range));
                obj.innerHTML = value;
                if (value == end) clearInterval(timer);
            }
            timer = setInterval(run, stepTime);
            run();
        }

        function renderHotSlangTable() {
            let tableBody = document.getElementById('hotSlangTable');
            let html = "";
            // S·ª≠ d·ª•ng d·ªØ li·ªáu th·∫≠t t·ª´ dictionary (n·∫øu c√≥)
            let limit = Math.min(dictionary.length, 20); 
            
            for (let i = 0; i < limit; i++) {
                let rank = i + 1;
                let word = dictionary[i].slang + " (" + dictionary[i].standard + ")";
                // Gi·∫£ l·∫≠p view count d·ª±a tr√™n v·ªã tr√≠ (ƒë·ªÉ demo ƒë·∫πp)
                let viewCount = Math.floor(2500 - (i * 120)) + Math.floor(Math.random()*50);
                if (viewCount < 50) viewCount = 50;

                let rankClass = "";
                if (rank === 1) rankClass = "rank-1";
                else if (rank === 2) rankClass = "rank-2";
                else if (rank === 3) rankClass = "rank-3";
                else rankClass = "rank-num";
                html += `<tr><td><span class="rank-num ${rankClass}">${rank}</span></td><td>${word}</td><td style="text-align: right;">${viewCount.toLocaleString()}</td></tr>`;
            }
            // N·∫øu d·ªØ li·ªáu √≠t qu√°, th√™m d√≤ng tr·ªëng
            if (limit === 0) {
                 html = `<tr><td colspan="3">Ch∆∞a c√≥ d·ªØ li·ªáu hot trend.</td></tr>`;
            }

            tableBody.innerHTML = html;
        }

        // --- SCROLL TO TOP ---
        window.onscroll = function() {
            const btn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // --- CHATBOT AI ---
        function toggleChat() {
            const chatWin = document.getElementById('chatWindow');
            chatWin.style.display = chatWin.style.display === 'flex' ? 'none' : 'flex';
        }
        function handleChat(e) { if(e.key === 'Enter') sendMessage(); }
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if(!msg) return;
            addChatMsg(msg, 'user');
            input.value = '';
            setTimeout(() => {
                let reply = "Xin l·ªói, m√¨nh ch∆∞a hi·ªÉu √Ω b·∫°n l·∫Øm. B·∫°n th·ª≠ h·ªèi t√™n m·ªôt t·ª´ l√≥ng xem?";
                const lowerMsg = msg.toLowerCase();
                if(lowerMsg.includes('ch√†o') || lowerMsg.includes('hi')) reply = "Ch√†o b·∫°n! M√¨nh l√† tr·ª£ l√Ω Ti·∫øng Vi·ªát.";
                else if(lowerMsg.includes('d·ª± √°n') || lowerMsg.includes('web')) reply = "ƒê√¢y l√† d·ª± √°n 'G√≥c Ti·∫øng Vi·ªát T·ª≠ T·∫ø' nh·∫±m gi·ªØ g√¨n s·ª± trong s√°ng c·ªßa ti·∫øng Vi·ªát v√† b·∫£o t·ªìn vƒÉn h√≥a Cor.";
                else if(lowerMsg.includes('admin') || lowerMsg.includes('t√°c gi·∫£')) reply = "Admin l√† b·∫°n L√™ V√µ C·∫©m T√∫ v√† B√πi Th·ªã H·ªìng Th·∫Øm l·ªõp 12C1 nh√©!";
                else {
                    const foundWord = dictionary.find(item => lowerMsg.includes(item.slang.toLowerCase()));
                    if (foundWord) {
                        reply = `√Ä, "${foundWord.slang}" c√≥ nghƒ©a l√† "${foundWord.standard}". ${foundWord.context ? "Th∆∞·ªùng d√πng trong b·ªëi c·∫£nh: " + foundWord.context : ""}`;
                    }
                }
                addChatMsg(reply, 'bot');
            }, 1000);
        }
        function addChatMsg(text, type) {
            const body = document.getElementById('chatBody');
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.innerText = text;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function startVoiceSearch() {
            if (!('webkitSpeechRecognition' in window)) { alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£!"); return; }
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'vi-VN';
            const micBtn = document.getElementById('micBtn');
            recognition.onstart = function() { micBtn.classList.add('listening'); };
            recognition.onend = function() { micBtn.classList.remove('listening'); };
            recognition.onresult = function(event) {
                document.getElementById('searchInput').value = event.results[0][0].transcript;
                searchWord();
            };
            recognition.start();
        }

        function speakWord(e, type) {
            e.stopPropagation();
            let text = "";
            if (type === 'slang') text = document.getElementById('displaySlang').innerText;
            else if (type === 'meaning') text = document.getElementById('displayMeaning').innerText;
            else text = type;
            text = text.replace(/"/g, '');
            let msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'vi-VN'; msg.rate = 0.9;
            try { window.speechSynthesis.speak(msg); } catch(err) {}
        }

        function generateCertificate() {
            let name = document.getElementById('certName').value;
            if(!name) { alert("Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!"); return; }
            const canvas = document.createElement('canvas');
            canvas.width = 1000; canvas.height = 700;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#43a047'; ctx.lineWidth = 20; ctx.strokeRect(40, 40, 920, 620);
            ctx.strokeStyle = '#DAA520'; ctx.lineWidth = 5; ctx.strokeRect(65, 65, 870, 570);
            ctx.textAlign = 'center';
            ctx.fillStyle = '#43a047'; ctx.font = 'bold 60px "Playfair Display", serif'; ctx.fillText('GI·∫§Y CH·ª®NG NH·∫¨N', canvas.width / 2, 180);
            ctx.fillStyle = '#333'; ctx.font = '30px "Roboto", sans-serif'; ctx.fillText('D·ª± √°n "G√≥c Ti·∫øng Vi·ªát T·ª≠ T·∫ø" tr√¢n tr·ªçng ghi nh·∫≠n:', canvas.width / 2, 240);
            ctx.fillStyle = '#DAA520'; ctx.font = '100px "Great Vibes", cursive'; ctx.fillText(name, canvas.width / 2, 360);
            ctx.fillStyle = '#333'; ctx.font = '30px "Roboto", sans-serif'; ctx.fillText('ƒê√£ cam k·∫øt gi·ªØ g√¨n s·ª± trong s√°ng c·ªßa Ti·∫øng Vi·ªát', canvas.width / 2, 440);
            ctx.fillText('v√† lan t·ªèa vƒÉn h√≥a h·ªçc ƒë∆∞·ªùng vƒÉn minh.', canvas.width / 2, 490);
            const today = new Date();
            const dateString = `Ng√†y ${today.getDate()} th√°ng ${today.getMonth() + 1} nƒÉm ${today.getFullYear()}`;
            ctx.font = 'italic 25px "Roboto", sans-serif'; ctx.fillStyle = '#666'; ctx.fillText(dateString, canvas.width / 2, 580);
            const link = document.createElement('a');
            link.download = `ChungNhan_${name.replace(/\s+/g, '_')}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function exportData() {
            let csvContent = "data:text/csv;charset=utf-8,Tu Long,Tieng Viet Chuan,Nguon Goc,Tieng Cor\n";
            dictionary.forEach(row => {
                let cor = row.cor ? row.cor : "";
                let origin = row.origin ? row.origin.replace(/,/g, " ") : ""; 
                csvContent += `${row.slang},${row.standard},${origin},${cor}\n`;
            });
            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "DuLieu_GocTiengViet.csv");
            document.body.appendChild(link);
            link.click();
        }

        function openQR() {
            document.getElementById('qrModal').style.display = 'flex';
            document.getElementById('qrcode').innerHTML = ""; 
            new QRCode(document.getElementById("qrcode"), { text: window.location.href, width: 200, height: 200 });
        }
        function closeQR() { document.getElementById('qrModal').style.display = 'none'; }

        function xuLyGuiForm(e) {
            e.preventDefault();
            const tuLong = document.getElementById('inpTuLong').value;
            const tiengViet = document.getElementById('inpTiengViet').value;
            const giaiThich = document.getElementById('inpGiaiThich').value;
            const checkContent = (tuLong + " " + tiengViet + " " + giaiThich).toLowerCase();
            for(let word of bannedWords) {
                if(checkContent.includes(word)) { alert("‚ö†Ô∏è Ph√°t hi·ªán t·ª´ ng·ªØ kh√¥ng ph√π h·ª£p!"); return; }
            }
            const btn = document.querySelector('.submit-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang g·ª≠i...';
            btn.disabled = true;
            btn.style.backgroundColor = "#999";
            
            const hoTen = document.getElementById('inpHoTen').value;
            const lop = document.getElementById('inpLop').value;
            const tiengCor = document.getElementById('inpTiengCor').value || "[Ch∆∞a r√µ]";
            
            // G·ª≠i d·ªØ li·ªáu qua API
            const params = new URLSearchParams();
            params.append('hoten', hoTen);
            params.append('lop', lop);
            params.append('tulong', tuLong);
            params.append('tiengviet', tiengViet);
            params.append('giaithich', giaiThich);
            params.append('tiengcor', tiengCor);

            // D√πng no-cors ƒë·ªÉ g·ª≠i d·ªØ li·ªáu form
            fetch(SCRIPT_URL, { method: "POST", mode: 'no-cors', body: params })
            .then(() => {
                alert("‚úÖ ƒê√£ g·ª≠i th√†nh c√¥ng!");
                document.getElementById('formDongGop').reset();
                // T·ª± th√™m v√†o m·∫£ng local ƒë·ªÉ hi·ªÉn th·ªã ngay l·∫≠p t·ª©c
                dictionary.push({ slang: tuLong, standard: tiengViet, context: giaiThich, origin: "M·ªõi ƒë√≥ng g√≥p", cor: tiengCor, contributor: hoTen, classInfo: lop });
                renderApp();
            })
            .catch(error => { alert("L·ªói k·∫øt n·ªëi, vui l√≤ng th·ª≠ l·∫°i!"); })
            .finally(() => { btn.innerHTML = originalText; btn.disabled = false; btn.style.backgroundColor = "var(--primary-color)"; });
        }
        
        // --- X·ª¨ L√ù CONFESSION (GI·∫¢ L·∫¨P LOCAL V√å GOOGLE FORM PH·ª®C T·∫†P H∆†N) ---
        function submitConfession() {
            const content = document.getElementById('cfsContent').value;
            if(!content) { alert("B·∫°n ch∆∞a vi·∫øt g√¨ c·∫£!"); return; }
             // ·ªû ƒë√¢y gi·∫£ l·∫≠p g·ª≠i th√†nh c√¥ng
            alert("ƒê√£ g·ª≠i Confession! Ch·ªù Admin duy·ªát nh√©.");
            document.getElementById('cfsContent').value = "";
        }

        // --- GAME LOGIC ---
        let currentGameWord = {}; let score = 0;
        function startGame() {
            if(dictionary.length < 4) { alert("C·∫ßn √≠t nh·∫•t 4 t·ª´!"); return; }
            score = 0; document.getElementById('gameScore').innerText = "ƒêi·ªÉm: 0";
            document.getElementById('gameStartScreen').style.display = 'none';
            document.getElementById('gamePlayArea').style.display = 'block';
            nextGameLevel();
        }
        function nextGameLevel() {
            let correctIdx = Math.floor(Math.random() * dictionary.length);
            currentGameWord = dictionary[correctIdx];
            let options = [currentGameWord.standard];
            while(options.length < 4) {
                let randomIdx = Math.floor(Math.random() * dictionary.length);
                let wrongWord = dictionary[randomIdx].standard;
                if(!options.includes(wrongWord)) options.push(wrongWord);
            }
            options.sort(() => Math.random() - 0.5);
            document.getElementById('gameQuestionText').innerText = currentGameWord.slang;
            let optionsHtml = "";
            options.forEach(opt => { optionsHtml += `<button class="btn-option" onclick="checkAnswer(this, '${opt}')">${opt}</button>`; });
            document.getElementById('gameOptions').innerHTML = optionsHtml;
        }
        function checkAnswer(btn, answer) {
            const allBtns = document.querySelectorAll('.btn-option');
            allBtns.forEach(b => b.disabled = true);
            if(answer === currentGameWord.standard) {
                btn.classList.add('correct'); btn.innerHTML += ' <i class="fas fa-check-circle"></i>';
                score += 10; document.getElementById('gameScore').innerText = "ƒêi·ªÉm: " + score;
                setTimeout(() => nextGameLevel(), 1000); 
            } else {
                btn.classList.add('wrong'); btn.innerHTML += ' <i class="fas fa-times-circle"></i>';
                allBtns.forEach(b => { if(b.innerText === currentGameWord.standard) b.classList.add('correct'); });
                setTimeout(() => nextGameLevel(), 1500); 
            }
        }

        // --- GAME C·∫¢NH S√ÅT CH√çNH T·∫¢ (Logic S∆° khai) ---
        function startSpellingGame() {
            if(dictionary.length === 0) return;
            // Ch·ªçn ng·∫´u nhi√™n 1 t·ª´ l√≥ng
            let rand = dictionary[Math.floor(Math.random() * dictionary.length)];
            const chatBody = document.getElementById('spellingGameBody');
            
            // X√≥a n√∫t b·∫Øt ƒë·∫ßu
            const startBtn = document.querySelector('.btn-start-chat');
            if(startBtn) startBtn.style.display = 'none';

            // T·∫°o tin nh·∫Øn m·ªõi
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chat-bubble chat-left';
            msgDiv.innerHTML = `√ä b√†, h√¥m nay nh√¨n b√† <span class='spelling-word' onclick='fixSpelling(this, "${rand.standard}")' style='color:red; font-weight:bold; text-decoration:underline'>${rand.slang}</span> qu√° √†!`;
            chatBody.appendChild(msgDiv);
        }

        function fixSpelling(span, correctWord) {
            span.onclick = null; // Disable click
            span.style.textDecoration = 'none';
            span.innerHTML = `<span style='color:green'>${correctWord}</span>`;
            
            // C·ªông ƒëi·ªÉm
            let currentScore = parseInt(document.getElementById('spellingScore').innerText);
            document.getElementById('spellingScore').innerText = currentScore + 10;
            
            // Reply t·ª± ƒë·ªông
            const chatBody = document.getElementById('spellingGameBody');
            const reply = document.createElement('div');
            reply.className = 'chat-bubble chat-right';
            reply.innerText = "Hehe, c·∫£m ∆°n ƒë√£ s·ª≠a gi√∫p tui nha!";
            setTimeout(() => { chatBody.appendChild(reply); }, 800);
            
            // Ti·∫øp t·ª•c
            setTimeout(() => startSpellingGame(), 2000);
        }

        // --- GAME TI·∫æNG COR ---
        const corVocab = [ {cor: "A-m√≠", viet: "M·∫π"}, {cor: "A-ma", viet: "Cha"}, {cor: "Ka-lƒÉng", viet: "ƒê·∫°i b√†ng"}, {cor: "Xa-n√≠a", viet: "C√°i v√°y"}, {cor: "P∆°-l√™", viet: "L√†ng"}, {cor: "Do-ri", viet: "Con g√†"} ];
        let hasFlippedCard = false, lockBoard = false, firstCard, secondCard;
        function initCorGame() {
            const grid = document.getElementById('corMemoryGrid');
            grid.innerHTML = '';
            let gameCards = [];
            corVocab.forEach(item => {
                gameCards.push({type: 'cor', val: item.cor, pairId: item.cor});
                gameCards.push({type: 'viet', val: item.viet, pairId: item.cor});
            });
            gameCards.sort(() => Math.random() - 0.5);
            gameCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('memory-card');
                cardElement.dataset.pair = card.pairId;
                cardElement.innerHTML = `<div class="memory-card-inner"><div class="memory-front">${card.val}</div><div class="memory-back"><i class="fas fa-question"></i></div></div>`;
                cardElement.addEventListener('click', flipCard);
                grid.appendChild(cardElement);
            });
        }
        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;
            this.classList.add('flipped');
            if (!hasFlippedCard) { hasFlippedCard = true; firstCard = this; return; }
            secondCard = this;
            checkForMatch();
        }
        function checkForMatch() {
            let isMatch = firstCard.dataset.pair === secondCard.dataset.pair;
            isMatch ? disableCards() : unflipCards();
        }
        function disableCards() {
            setTimeout(() => { firstCard.classList.add('matched'); secondCard.classList.add('matched'); resetBoard(); }, 500);
        }
        function unflipCards() {
            lockBoard = true;
            setTimeout(() => { firstCard.classList.remove('flipped'); secondCard.classList.remove('flipped'); resetBoard(); }, 1000);
        }
        function resetBoard() { [hasFlippedCard, lockBoard] = [false, false]; [firstCard, secondCard] = [null, null]; }
        function resetCorGame() { initCorGame(); }

        window.onload = function() { 
            try { AOS.init(); } catch(e) {}
            loadDataFromSheet(); 
            initCorGame(); 
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                if(preloader && preloader.style.display !== 'none') {
                    preloader.style.opacity = '0';
                    setTimeout(() => { preloader.style.display = 'none'; }, 500);
                }
            }, 3000); 
        };
    </script>
</body>
</html>
